(function(){var a,b,c,d=function(a,b){return function(){return a.apply(b,arguments)}},e=[].indexOf||function(a){for(var b=0,c=this.length;c>b;b++)if(b in this&&this[b]===a)return b;return-1};b=pimatic.tryCatch,$(document).on("pagecreate","#index",b(function(){var a,f,g,h;a=function(){function a(){this.onDropItemOnTrash=d(this.onDropItemOnTrash,this),this.onItemsSorted=d(this.onItemsSorted,this),this.toggleEditing=d(this.toggleEditing,this),this.onLogoutClicked=d(this.onLogoutClicked,this),this.onLogMessageClicked=d(this.onLogMessageClicked,this),this.onAddItemClicked=d(this.onAddItemClicked,this),this.onPageTabClicked=d(this.onPageTabClicked,this),this.showDevicePage=d(this.showDevicePage,this),this.getItemTemplate=d(this.getItemTemplate,this);var c,f,g,h,i,j,k,l,m,n,o,p;if(this.groups=pimatic.groups,this.hasPermission=pimatic.hasPermission,this.updateFromJs({ruleItemCssClass:"",hasRootCACert:!1}),this.lockButton=ko.computed(b(function(a){return function(){var b;return b=a.enabledEditing(),{icon:b?"check":"gear"}}}(this))),this.logoutText=ko.computed(b(function(){return function(){return"string"==typeof pimatic.username()?__("Logout")+" ("+pimatic.username()+")":__("Logout")}}(this))),j=null,i=null,g=null,h={offset:40,tolerance:10,classes:{initial:"animated",pinned:"slideDown",unpinned:"slideUp"}},l=null,k=null,o=null,n=function(a){return function(b){var c,d,e;return null==b&&(b=!0),null!=j&&null!=i?(d=null!=a.activeDevicepage()?a.devicepages.indexOf(a.activeDevicepage()):0,e=$(i.find(".items")[d]).width(),e!==l&&j.css({width:e}),c=j.height(),c!==k&&i.find(".items").each(function(){return $(this).parent().css("padding-top",c)}),clearTimeout(o),b&&(o=setTimeout(function(){return n(!1)},350)),l=e,k=c):void 0}}(this),this.devicepagesTabsRefresh=ko.computed(b(function(a){return function(){var b,c,d,e,f,i;if(a.bindingsApplied())return b=a.devicepages(),c=a.enabledEditing(),j=$("#item-tabs"),null!=g&&g.destroy(),pimatic["try"](function(){return j.navbar("destroy")}),ko.cleanNode(j[0]),e=b.length>0&&a.hasPermission("pages","read")?"<ul data-bind=\"foreach: devicepages\">\n  <li>\n    <a \n      data-ajax='false' \n      data-bind=\"attr: {\n        href: '#item-tab-'+$data.id}, \n        text: name, \n        css: {'ui-btn-active': $data == $root.activeDevicepage()}, \n        click: $root.onPageTabClicked\"\n    ></a>\n  </li>\n</ul>":"<ul></ul>",j.html(e),ko.applyBindings(a,j[0]),c&&j.find("ul").append($("#edit-devicepage-link-template").text()),(b.length>0||a.enabledEditing())&&a.hasPermission("pages","read")&&(j.navbar(),j.find("ul").removeClass("ui-grid-a ui-grid-duo"),i=j.find("li"),i.length<=6?(f=100/i.length+"%",d=i.length):(d=Math.ceil(i.length/2),f=100/d+"%"),i.each(function(a){var b;return $(this).css({width:f,clear:"none"}).removeClass("ui-block-a ui-block-b ui-block-c ui-block-d ui-block-e").addClass("ui-block-a"),b=$(this).find("a"),a+1>d?b.css("border-top-width",0):void 0}),g=new Headroom(j[0],h),g.init()),n()}}(this))).extend({rateLimit:{timeout:1,method:"notifyWhenChangesStop"}}),m=function(a){return function(){var b;return null!=g&&null!=a.activeDevicepage()?(g.destroy(),b=a.devicepages.indexOf(a.activeDevicepage()),h.scroller=i.find(".owl-wrapper .owl-item")[b],g=new Headroom(j[0],h),g.init()):void 0}}(this),p=[],ko.computed(b(function(a){return function(){var b,c,d,e,f,g,h,j,k,l;if(a.bindingsApplied()){for(d=a.devicepages(),e=ko.utils.compareArrays(d,p),p=function(){var a,b,c;for(c=[],a=0,b=d.length;b>a;a++)j=d[a],c.push(j);return c}(),b=!1,k=0,l=e.length;l>k;k++)if(c=e[k],"retained"!==c.status){b=!0;break}b&&(i=$("#item-lists"),ko.cleanNode(i[0]),h=i.data("owlCarousel"),null!=h&&h.destroy(),d.length>0&&a.hasPermission("pages","read")?(f=$("#devicepages-template").text(),i.html(f),null!=ko.dataFor($("#index")[0])&&ko.applyBindings(a,i[0]),i.find('[data-role="listview"]').listview(),i.owlCarousel({slideSpeed:300,paginationSpeed:400,singleItem:!0,pagination:!1,navigation:!1,lazyEffect:!1,lazyLoad:!1,afterAction:function(){},afterMove:function(b){var c;return c=b.data("owlCarousel").currentItem,a.activeDevicepage(a.devicepages()[c])},afterUpdate:function(){return n()}}),g=i.width(),m()):i.html(""),n())}}}(this))).extend({rateLimit:{timeout:1,method:"notifyWhenChangesStop"}}),this.activeDevicepage.subscribe(function(a){return function(b){var c,d;if(null!=b&&(d=$("#item-lists").data("owlCarousel"),null!=d&&(c=a.devicepages.indexOf(b),-1!==c)))return d.goTo(c),m(),n()}}(this)),ko.computed(function(a){return function(){var b,c;return b=a.devicepages(),0===b.length?a.activeDevicepage(null):null==a.activeDevicepage()?a.activeDevicepage(b[0]):(c=a.activeDevicepage(),e.call(b,c)>=0?void 0:a.activeDevicepage(b[0]))}}(this)),this.itemsListViewRefresh=ko.computed(b(function(a){return function(){var b,c,d,e,f,g,h,i;for(h=a.devicepages(),d=0,f=h.length;f>d;d++)b=h[d],b.devices();for(i=pimatic.groups(),e=0,g=i.length;g>e;e++)c=i[e],c.devices();return a.isSortingItems(),a.enabledEditing(),pimatic["try"](function(){return $('#item-lists [data-role="listview"]').each(function(){var a;return a=$(this),null==a.data("mobileListview")?a.listview():a.listview("refresh")})})}}(this))).extend({rateLimit:{timeout:1,method:"notifyWhenChangesStop"}}),this.deviepagesRefresh=ko.computed(b(function(a){return function(){return a.devicepages(),pimatic["try"](function(){return $(".nav-panel-menu").listview("refresh")})}}(this))).extend({rateLimit:{timeout:1,method:"notifyWhenChangesStop"}}),pimatic.storage.isSet("pimatic.indexPage")){c=pimatic.storage.get("pimatic.indexPage");try{this.updateFromJs(c)}catch(q){f=q,TraceKit.report(f),pimatic.storage.removeAll(),window.location.reload()}}this.autosave=ko.computed(function(b){return function(){return c=ko.mapper.toJS(b,a.mapping),pimatic.storage.set("pimatic.indexPage",c)}}(this)).extend({rateLimit:{timeout:500,method:"notifyWhenChangesStop"}}),this.toggleEditingText=ko.computed(b(function(a){return function(){return __(a.enabledEditing()?"Lock lists":"Edit lists")}}(this)))}return a.mapping={$default:"ignore",ruleItemCssClass:"observe",hasRootCACert:"observe"},a.prototype.devicepages=pimatic.devicepages,a.prototype.errorCount=pimatic.errorCount,a.prototype.activeDevicepage=ko.observable(null),a.prototype.isSortingItems=ko.observable(!1),a.prototype.enabledEditing=ko.observable(!1),a.prototype.bindingsApplied=ko.observable(!1),a.prototype.getItemTemplate=function(a){return""+a.getItemTemplate()+"-template"},a.prototype.showDevicePage=function(a){return this.activeDevicepage(a),$("#nav-panel").panel("close"),!0},a.prototype.updateFromJs=function(b){return ko.mapper.fromJS(b,a.mapping,this)},a.prototype.onPageTabClicked=function(a){return this.activeDevicepage(a)},a.prototype.onAddItemClicked=function(){return!0},a.prototype.onLogMessageClicked=function(){return jQuery.mobile.pageParams={selectErrors:!0},!0},a.prototype.onLogoutClicked=function(){return $.ajax({type:"GET",url:"/logout"}).fail(function(){return function(a,b,c){return"Unauthorized"===b||"Unauthorized"===c?setTimeout(function(){return pimatic.storage.removeAll(),pimatic.showToast(a.responseText),window.location.reload()},100):ajaxAlertFail(a,b,c)}}(this)),!1},a.prototype.toggleEditing=function(){return this.enabledEditing(!this.enabledEditing())},a.prototype.onItemsSorted=function(a,b){var c,d,e,f,g,h;return c=function(){return function(b,c){var d,e;return e=null==c?0:ko.utils.arrayIndexOf(b.devices(),c.device.id)+1,-1===e&&(e=0),d=b.id,pimatic.client.rest.addDeviceToGroup({deviceId:a.device.id,groupId:d,position:e}).done(ajaxShowToast).fail(ajaxAlertFail)}}(this),g=function(){return function(b){var c;return c=b.id,pimatic.client.rest.removeDeviceFromGroup({deviceId:a.device.id,groupId:c}).done(ajaxShowToast).fail(ajaxAlertFail)}}(this),h=function(b){return function(c){var d,e,f,g,h;for(d=[],null==c&&d.push(a.device.id),h=b.activeDevicepage().devices(),f=0,g=h.length;g>f;f++)e=h[f],e!==a&&(d.push(e.device.id),null!=c&&e===c&&d.push(a.device.id));return pimatic.client.rest.updatePage({pageId:b.activeDevicepage().id,page:{devicesOrder:d}}).done(ajaxShowToast).fail(ajaxAlertFail)}}(this),null!=b?(d=b instanceof pimatic.DeviceItem?b.device.group():b instanceof pimatic.Group?b:null,f=b instanceof pimatic.DeviceItem?b:void 0,e=a.device.group(),d!==e?null!=d?(c(d,f),h(f)):null!=e?(g(e),h(f)):h(f):h(f)):void 0},a.prototype.onDropItemOnTrash=function(a){var b,c;return c=confirm(__("Do you really want to delete the item?")),c?(b=function(b){return function(){var c;return c=b.activeDevicepage(),pimatic.loading("deleteitem","show",{text:__("Saving")}),pimatic.client.rest.removeDeviceFromPage({deviceId:a.deviceId,pageId:c.id}).always(function(){return pimatic.loading("deleteitem","hide")}).done(ajaxShowToast).fail(ajaxAlertFail)}}(this))():void 0},a}(),pimatic.pages.index=g=new a;try{ko.applyBindings(g,$("#index")[0]),g.bindingsApplied(!0)}catch(i){f=i,TraceKit.report(f),null!=(h=pimatic.storage)&&h.removeAll(),window.location.reload()}$("#index").on("change","#item-lists .switch",b(function(){var a;a=ko.dataFor(this),a.onSwitchChange()})),$("#index").on("slidestop"," #item-lists .dimmer",b(function(){var a;a=ko.dataFor(this),a.onSliderStop()})),$("#index").on("vclick","#item-lists .shutter-down",b(function(){var a;return a=ko.dataFor(this),a.onShutterDownClicked(),!1})),$("#index").on("vclick","#item-lists .shutter-up",b(function(){var a;return a=ko.dataFor(this),a.onShutterUpClicked(),!1})),$("#index").on("vclick","#item-tabs #add-devicepage-link",b(function(){return g.onAddPageClicked(),!0})),$("#items .handle").disableSelection(),$("#nav-panel").on("panelopen panelclose",b(function(){var a;return a=$("#item-lists"),a.is(":visible")?c():void 0}))})),a=0,c=function(){return pimatic["try"](function(){return function(){var b,c;return b=$("#item-lists"),c=b.width(),c!==a&&b.data("owlCarousel").updateVars(),a=c}}(this))},$(document).on("click",".content-overlay",b(function(){return $("#nav-panel").panel("close")})),$(document).on("pageshow","#index",b(function(){return c(),setTimeout(function(){return c()},1)})),$(document).on("pagebeforeshow","#index",b(function(){return setTimeout(function(){return pimatic["try"](function(){return function(){return $("#nav-panel").find('[data-role="listview"]').listview("refresh")}}(this)),pimatic["try"](function(){return function(){return $("#item-lists").find('[data-role="listview"]').listview("refresh")}}(this)),pimatic["try"](function(){return function(){return $("#item-tabs").navbar()}}(this))},2)}))}).call(this);