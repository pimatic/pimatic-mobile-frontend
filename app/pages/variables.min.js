(function(){var a,b=function(a,b){return function(){return a.apply(b,arguments)}};a=pimatic.tryCatch,$(document).on("pagebeforecreate","#variables-page",a(function(){var c,d;return c=function(){function c(){this.onEditVariableClicked=b(this.onEditVariableClicked,this),this.onVariablesSorted=b(this.onVariablesSorted,this),this.variables=pimatic.variables,this.groups=pimatic.groups,this.hasPermission=pimatic.hasPermission,this.variablesListViewRefresh=ko.computed(a(function(a){return function(){var b,c,d,e;for(a.variables(),a.enabledEditing(),e=a.groups(),c=0,d=e.length;d>c;c++)b=e[c],b.variables();return pimatic["try"](function(){return $("#variables").listview("refresh").addClass("dark-background")})}}(this))).extend({rateLimit:{timeout:1,method:"notifyWhenChangesStop"}}),this.lockButton=ko.computed(a(function(a){return function(){var b;return b=a.enabledEditing(),{icon:b?"check":"gear"}}}(this))),this.visibleVars=ko.computed(a(function(a){return function(){return ko.utils.arrayFilter(a.variables(),function(b){return a.showAttributeVars()||!b.isDeviceAttribute()})}}(this))),this.toggleEditingText=ko.computed(a(function(a){return function(){return __(a.enabledEditing()?"Lock lists":"Edit lists")}}(this))),this.showAttributeVarsText=ko.computed(a(function(a){return function(){return __(a.showAttributeVars()?"Hide device attribute variables":"Show device attribute variables")}}(this))),this.getUngroupedVariables=ko.computed(a(function(a){return function(){var b,c,d,e,f,g,h,i,j,k;for(d=[],c=[],j=a.groups(),f=0,h=j.length;h>f;f++)b=j[f],c=c.concat(b.variables());for(k=a.variables(),g=0,i=k.length;i>g;g++)e=k[g],e.isDeviceAttribute()||-1===ko.utils.arrayIndexOf(c,e.name)&&d.push(e);return d}}(this))),this.getDeviceAttributeVariables=ko.computed(a(function(a){return function(){var b;return function(){var a,c,d,e;for(d=this.variables(),e=[],a=0,c=d.length;c>a;a++)b=d[a],b.isDeviceAttribute()&&e.push(b);return e}.call(a)}}(this)))}return c.prototype.enabledEditing=ko.observable(!1),c.prototype.isSortingVariables=ko.observable(!1),c.prototype.showAttributeVars=ko.observable(!1),c.prototype.afterRenderVariable=function(a){var b;return b=$("#sortable-handle-template").text(),$(a).find("a").before($(b))},c.prototype.toggleEditing=function(){return this.enabledEditing(!this.enabledEditing())},c.prototype.onVariablesSorted=function(a,b){var c,d,e,f,g,h,i;return c=function(){return function(b,c){var d,e;return e=null==c?0:ko.utils.arrayIndexOf(b.variables(),c.name)+1,-1===e&&(e=0),d=b.id,pimatic.client.rest.addVariableToGroup({variableName:a.name,groupId:d,position:e}).done(ajaxShowToast).fail(ajaxAlertFail)}}(this),f=function(){return function(b){var c;return c=b.id,pimatic.client.rest.removeVariableFromGroup({variableName:a.name,groupId:c}).done(ajaxShowToast).fail(ajaxAlertFail)}}(this),h=function(b){return function(c){var d,e,f,g,h;for(e=[],null==c&&e.push(a.name),h=b.variables(),f=0,g=h.length;g>f;f++)d=h[f],d!==a&&(e.push(d.iname),null!=c&&d===c&&e.push(a.name));return pimatic.client.rest.updateVariableOrder({variableOrder:e}).done(ajaxShowToast).fail(ajaxAlertFail)}}(this),g=function(){return function(b,c){var d,e,f,g,h;for(e=[],null==c&&e.push(a.name),h=b.variables(),f=0,g=h.length;g>f;f++)d=h[f],d!==a.name&&(e.push(d),null!=c&&d===c.name&&e.push(a.name));return pimatic.client.rest.updateGroup({groupId:b.id,group:{variablesOrder:e}}).done(ajaxShowToast).fail(ajaxAlertFail)}}(this),null!=b?(d=b instanceof pimatic.Variable?b.group():b instanceof pimatic.Group?b:null,i=b instanceof pimatic.Variable?b:void 0,e=a.group(),d!==e?null!=d?c(d,i):null!=e?f(e):h(i):null!=d?g(d,i):h(i)):void 0},c.prototype.onDropVariableOnTrash=function(a){var b,c;return c=confirm(__("Do you really want to delete the variable %s?",a.name)),c?(b=function(b){return function(){return pimatic.loading("deletevariable","show",{text:__("Saving")}),pimatic.client.rest.removeVariable({name:a.name}).done(function(c){return c.success?b.variables.remove(a):void 0}).always(function(){return pimatic.loading("deletevariable","hide")}).done(ajaxShowToast).fail(ajaxAlertFail)}}(this))():void 0},c.prototype.onAddVariableClicked=function(){var a;return a=pimatic.pages.editVariable,a.resetFields(),a.action("add"),!0},c.prototype.onEditVariableClicked=function(a){var b;return this.hasPermission("variables","write")||pimatic.isDemo()?a.isDeviceAttribute()?!1:(b=pimatic.pages.editVariable,b.variableName(a.name),b.variableValue("value"===a.type()?a.value():a.exprInputStr()),b.variableType(a.type()),b.variableUnit(a.unit()),b.action("update"),!0):(pimatic.showToast(__("Sorry, you have no permissions to edit this variable.")),!1)},c}(),pimatic.pages.variables=d=new c})),$(document).on("pagecreate","#variables-page",a(function(){var a,b,c;b=pimatic.pages.variables;try{ko.applyBindings(b,$("#variables-page")[0])}catch(d){a=d,TraceKit.report(a),null!=(c=pimatic.storage)&&c.removeAll(),window.location.reload()}$("#variables .handle").disableSelection()})),$(document).on("pagebeforeshow","#variables-page",a(function(){return pimatic["try"](function(){return function(){return $("#variables").listview("refresh").addClass("dark-background")}}(this))}))}).call(this);