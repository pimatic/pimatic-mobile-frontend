(function(){var a=[].indexOf||function(a){for(var b=0,c=this.length;c>b;b++)if(b in this&&this[b]===a)return b;return-1};!function(){var b,c;return c=function(a,b){var c,d;return d=function(){var b,d,e,f;for(e=a.attr("class").split(" "),f=[],b=0,d=e.length;d>b;b++)c=e[b],0!==c.lastIndexOf("ui-icon-")&&f.push(c);return f}(),d.push("ui-icon-"+b),a.attr("class",d.join(" "))},ko.bindingHandlers.jqmbutton={init:function(a,b){var c,d,e;d=b(),e=ko.unwrap(d),c=$(a)},update:function(a,b){var d,e,f,g,h,i,j;if(i=b(),j=ko.unwrap(i),d=$(a),null!=j.text&&(h=ko.unwrap(j.text),d.text(h)),null!=j.icon&&(g=ko.unwrap(j.icon),c(d,g)),null!=j.enabled)if(f=ko.unwrap(j.enabled))try{d.button("enable")}catch(k){e=k,d.removeClass("ui-state-disabled")}else try{d.button("disable")}catch(k){e=k,d.addClass("ui-state-disabled")}}},ko.bindingHandlers.jqmlistitem={update:function(a,b){var d,e,f,g;return f=b(),g=ko.unwrap(f),d=$(a),null!=f.icon?(e=ko.unwrap(f.icon),c(d,e)):void 0}},ko.bindingHandlers.jqmenabled={update:function(a,b){var c,d,e;switch(d=b(),e=ko.unwrap(d),c=$(a),a.type){case"select-one":c.selectmenu(e?"enable":"disable");break;default:c.textinput(e?"enable":"disable")}}},ko.bindingHandlers.jqmchecked={init:ko.bindingHandlers.checked.init,update:function(a,b){var c,d;c=b(),d=ko.unwrap(c),$(a).checkboxradio("refresh")}},ko.bindingHandlers.jqmselectedOptions={init:function(a,b){var c,d;return d=b(),c=$(a),c.on("change",function(){return function(){var a;return a=c.val(),null==a&&(a=[]),d(a)}}(this))},update:function(a,b){var c,d;d=b(),c=$(a),c.val(d()),c.selectmenu("refresh",!0)}},ko.bindingHandlers.jqmoptions={init:ko.bindingHandlers.options.init,update:function(a,b,c){var d;ko.bindingHandlers.options.update(a,b,c),d=b(),$(a).selectmenu("refresh")}},ko.bindingHandlers.sparkline={init:function(a,b){return ko.bindingHandlers.sparkline.update(a,b),setTimeout(function(){return $.sparkline_display_visible()},100)},update:function(a,b){var c,d,e,f;return e=b(),f=ko.unwrap(e),c=ko.unwrap(f.data),d=f.tooltipFormatter,$(a).sparkline(c,{disableTooltips:!0,type:"line",lineColor:"#7c7c7c",fillColor:"#cccccc",spotColor:"#666666",minSpotColor:null,maxSpotColor:null,highlightSpotColor:null,highlightLineColor:null,drawNormalOnTop:!1,tooltipFormatter:d})}},ko.bindingHandlers.toast={init:function(a,b){var c,d,e,f;return e=b(),f=ko.unwrap(e),c=$(a),c.text(f),c.toast(),c.toast("show"),d=c.outerHeight()+2,c.parent().find(".ui-toast").each(function(){var b,c;this!==a&&(b=$(this),b.addClass("animated-toast"),c=b.data("top")+d,b.css("top",c+"px"),b.data("top",c))})}},ko.bindingHandlers.tooltip={init_tooltip:function(a,b){var c,d;return $(window).width()<1.5*b.outerWidth()?b.css("max-width",$(window).width()/2):b.css("max-width",340),c=a.offset().left+a.outerWidth()/2-b.outerWidth()/2,d=a.offset().top-b.outerHeight()-20,0>c?(c=a.offset().left+a.outerWidth()/2-20,b.addClass("left")):b.removeClass("left"),c+b.outerWidth()>$(window).width()?(c=a.offset().left-b.outerWidth()+a.outerWidth()/2+20,b.addClass("right")):b.removeClass("right"),d+b.outerHeight()>$(window).height()?b.removeClass("top"):(d=a.offset().top+a.outerHeight()-10,b.addClass("top")),b.removeClass("animated-tooltip").css({left:c,top:d,opacity:0}),b[0].offsetWidth=b[0].offsetWidth,b.addClass("animated-tooltip").css({top:d+20}).animate({opacity:1},100),b},remove_tooltip:function(a,b){return b.animate({opacity:0},100,function(){return function(){return b.removeClass("animated-tooltip").remove()}}(this))},init:function(b,c){var d,e;return d=$(b),e=c(),d.bind("vclick",function(){var b,f,g,h,i,j,k;return i=ko.unwrap(e),i&&""!==i?(j=$("#tooltip"),0===j.length&&(j=$('<div id="tooltip" class="ui-corner-all"></div>'),j.css("opacity",0).html(i).appendTo("body")),null!=(k=ko.bindingHandlers.tooltip.subscribtion)&&k.dispose(),clearInterval(ko.bindingHandlers.tooltip.interval),clearTimeout(ko.bindingHandlers.tooltip.timeout),ko.bindingHandlers.tooltip.init_tooltip(d,j),ko.bindingHandlers.tooltip.subscribtion=ko.computed(function(){return function(){return i=c()(),j.html(i),ko.bindingHandlers.tooltip.init_tooltip(d,j)}}(this)),b=d.parents(".ui-content"),h=function(){return function(){return clearInterval(ko.bindingHandlers.tooltip.interval),clearTimeout(ko.bindingHandlers.tooltip.timeout),ko.bindingHandlers.tooltip.subscribtion.dispose(),ko.bindingHandlers.tooltip.remove_tooltip(d,j),b.off("scroll",h),j.off("vclick",h),"undefined"!=typeof g&&null!==g&&d.off("mouseleave",g),!0}}(this),f=a.call(window,"ontouchstart")>=0,f||d.one("mouseleave",g=function(){return clearInterval(ko.bindingHandlers.tooltip.interval),ko.bindingHandlers.tooltip.interval=setInterval(function(){return 0===$("#tooltip:hover").length?h():void 0},1e3)}),clearTimeout(ko.bindingHandlers.tooltip.timeout),ko.bindingHandlers.tooltip.timeout=setTimeout(function(){return j.one("vclick",h)},300),void b.one("scroll",h)):!1})}},b=function(a){return this.element=a,this.$element=$(a),this.scrollMargin=Math.floor(this.$element.innerHeight()/10),this.offset=this.$element.offset(),this.innerHeight=this.$element.innerHeight(),this.scrollDeltaMin=5,this.scrollDeltaMax=30},b.prototype.scroll=function(a,b){var c,d,e,f,g,h;return h=this.scrollMargin+this.offset.top,g=void 0,d=0,h>b&&(g=(h-b)/this.scrollMargin,d=-(g*(this.scrollDeltaMax-this.scrollDeltaMin)+this.scrollDeltaMin)),c=this.offset.top+this.innerHeight-this.scrollMargin,b>c&&(g=(b-c)/this.scrollMargin,d=g*(this.scrollDeltaMax-this.scrollDeltaMin)+this.scrollDeltaMin),0!==d&&(e=this.$element.scrollTop(),f=this.$element.scrollTop(e+d),d=this.$element.scrollTop()-e),d},ko.bindingHandlers.sortable={init:function(a,c,d,e){var f,g,h;return h=c(),g=h.items,f=function(){return function(b){var c,d,e,f,g;return f=null,d=null,g=null,e=null,c=b.offset(),$(a).find(".sortable").each(function(a,h){var i,j,k;if(h!==b[0])if(i=$(h).offset(),i.top<c.top){if(null==g||i.top>g.top)return j=[h,i],f=j[0],g=j[1],j}else if(i.top>c.top&&(null==e||i.top<e.top))return k=[h,i],d=k[0],e=k[1],k}),{eleBefore:f,eleAfter:d}}}(this),$(a).on("MSPointerDown touchstart mousedown",".handle",function(c){var d,i,j,k,l,m,n,o;return i=$(this).parents(".sortable"),m=function(){return function(){var b,c,d,e,g,h,j,k;return j=i.offset(),g=i.outerHeight(),j.bottom=j.top+g,k=f(i),d=k.eleBefore,b=k.eleAfter,$(a).find(".sortable").each(function(a,b){return b!==i[0]?($(b).css("margin-bottom",0),$(b).css("margin-top",0)):void 0}),null!=d?(e=$(d).offset(),e.width=$(d).outerHeight(),e.middle=e.top+e.width/2,e.bottom=e.top+e.width,j.top<e.middle?$(d).css("margin-top",g):null!=b?(c=$(b).offset(),c.width=$(b).outerHeight(),c.middle=c.top+c.width/2,j.bottom>c.middle&&j.top>e.bottom+g/2?$(b).css("margin-bottom",g):$(d).css("margin-bottom",g)):$(d).css("margin-bottom",g)):null!=b&&$(b).css("margin-top",g),h=j.top-i.offset().top,0!==h?i.data("plugin_pep").doMoveTo(0,h):void 0}}(this),l=function(){return function(){var a,b,c,d,j,k,l,m,n,o,p;if(p=f(i),d=p.eleBefore,c=p.eleAfter,null!==d||null!==c)if(j=ko.dataFor(i[0]),b=null!=d?ko.dataFor(d):void 0,a=null!=c?ko.dataFor(c):void 0,null!=g){if(m=g.indexOf(j),n=null!=d?(k=g.indexOf(b)+1,k>m?k--:void 0,k):0,m>=0&&n>=0&&m!==n&&(o=ko.utils.unwrapObservable(g),l=o[m],g.valueWillMutate(),o.splice(m,1),o.splice(n,0,l),g.valueHasMutated(),null!=h.sorted))return h.sorted.call(e,j,b,a)}else if(null!=h.sorted)return h.sorted.call(e,j,b,a)}}(this),n=null,o=null,j=null,k=null,d=null,i.pep({place:!1,axis:"y",shouldEase:!1,constrainTo:"parent",droppable:h.droppable||".droppable",overlapFunction:function(){return function(a,b){var c,d,e;return d=a[0].getBoundingClientRect(),e=b[0].getBoundingClientRect(),c=e.bottom-d.bottom>-20&&e.bottom-d.bottom<10}}(this),start:function(){return function(){var c,e;return $(a).css("height",$(a).height()),clearTimeout(d),null!=h.isSorting&&h.isSorting(!0),$(a).addClass("noAnimation"),i.css("margin-bottom",-i.innerHeight()),j=new b($("#index .ui-content.overthrow")[0]),c=null,e=null,k=setInterval(function(){var a;return a=j.scroll(n,o),0!==a?i.data("plugin_pep").doMoveTo(0,a):void 0},100)}}(this),stop:function(){return function(b,c){var f,g;return clearTimeout(k),f=c.activeDropRegions.length>0,$(c.activeDropRegions).each(function(a,b){return null!=h.drop?h.drop.call(e,ko.dataFor(i[0]),b):void 0}),f||l(),g=i.data("plugin_pep"),$.pep.unbind(i),$(a).find(".sortable").attr("style",""),$(a).css("height",""),null!=h.isSorting&&h.isSorting(!1),d=setTimeout(function(){return $(a).removeClass("noAnimation")},100),i.removeClass("ui-btn-active")}}(this),drag:function(){return function(a){return n=a.pageX,o=a.pageY,m(),!0}}(this)}),i.data("plugin_pep").handleStart(c),c.stopImmediatePropagation()})}},ko.bindingHandlers.jqmselectvalue={init:function(a,b,c,d){return"undefined"!=typeof ko.bindingHandlers.value.init?ko.bindingHandlers.value.init(a,b,c,d):void 0},update:function(a,b,c,d){return"undefined"!=typeof ko.bindingHandlers.value.update&&ko.bindingHandlers.value.update(a,b,c,d),$(a).selectmenu("refresh",!0)}},ko.bindingHandlers.dragslide={init:function(a,b){var c,d,e,f,g,h,i;h=b(),i=ko.toJS(h),c=i.options||{},$(a).css({overflow:"hidden"}),$(a).on("selectstart mousedown",function(a){return a.preventDefault()}),g=function(){return function(a,b){return $(".drag-message").text(b).css({top:a.position().top,height:a.outerHeight(),"line-height":a.outerHeight()+"px"}).fadeIn(500)}}(this),e=null,d=!1,$(a).on("click",function(a){return d?a.preventDefault():e=null}),f=null,$(a).on("vmousedown",".draggable",function(){return function(a){return f=$(a.target).parents(".draggable"),(null!=f?f.length:void 0)?e=a:void 0}}(this)),$(a).on("vmousemove",".draggable",function(){return function(a){var b,c,h,i,j,k;return k=$(a.target).parents(".draggable"),null!=e&&(null!=k?k.length:void 0)&&(null!=f?f.length:void 0)&&f[0]===k[0]?(c=Math.abs(a.pageX-e.pageX),h=Math.abs(a.pageY-e.pageY),c>h&&c>5?(a.preventDefault(),a.stopPropagation(),e.preventDefault(),i=ko.dataFor(k[0]),b=null,j=k.position(),k.pep({place:!1,axis:"x",shouldEase:!0,revert:!0,shouldPreventDefault:!1,start:function(){return d=!0},rest:function(){var a;return a=k.data("plugin_pep"),$.pep.unbind(k),k.attr("style",""),d=!1},drag:function(){var a;return a=k.position().left-j.left,-120>a?"deactivate"!==b&&(g(k,__("deactivate rule")).addClass("deactivate").removeClass("activate"),b="deactivate"):a>120?"activate"!==b&&(g(k,__("activate rule")).addClass("activate").removeClass("deactivate"),b="activate"):null!=b&&($(".drag-message").fadeOut(500),b=null),!0},stop:function(){var a;return $(".drag-message").text("").fadeOut().removeClass("activate").removeClass("deactivate"),null!=b&&(a="activate"===b,pimatic.loading("saveactivate","show",{text:__(b)}),pimatic.client.rest.updateRuleByString({ruleId:i.id,rule:{active:a}}).always(function(){return pimatic.loading("saveactivate","hide")}).done(ajaxShowToast).fail(ajaxAlertFail)),k.removeClass("ui-btn-active")}}),k.data("plugin_pep").revert=function(){return this.shouldUseCSSTranslation()&&this.moveToUsingTransforms(-this.xTranslation(),0),this.moveTo(this.initialPosition.left,0)},k.data("plugin_pep").handleStart(e),e=null):void 0):(f=null,void(e=null))}}(this))}}}()}).call(this);